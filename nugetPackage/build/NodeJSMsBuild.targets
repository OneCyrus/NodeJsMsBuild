<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="12.0">

<PropertyGroup>
  <Npm>$()</Npm>
  <Bower>$()</Bower>
  <Tsd>$()</Tsd>
  <Gulp>$()</Gulp>
  <Grunt>$()</Grunt>
</PropertyGroup>

  <Target Name="CleanNodeJsFiles" BeforeTargets="BeforeClean">
      <ItemGroup>
        <TypeScriptGenerated Include="%(TypeScriptCompile.RelativeDir)%(TypeScriptCompile.Filename).js" Condition="!$([System.String]::new('%(TypeScriptCompile.Filename)').EndsWith('.d'))" />
        <TypeScriptGenerated Include="%(TypeScriptCompile.RelativeDir)%(TypeScriptCompile.Filename).js.map" Condition="!$([System.String]::new('%(TypeScriptCompile.Filename)').EndsWith('.d'))" />
    </ItemGroup>
    <Delete Files="@(TypeScriptGenerated)" />
    <RemoveDir Directories=".\bower_components\;.\typings\"/>
    <Exec Command="DelFolder .\node_modules" />
  </Target>

  <Target Name="RestoreNodeJsPackages" BeforeTargets="BeforeBuild">
    <Warning Text="Unable to find npm command line; NodeJS tasks will not be executed" Condition="!$(Npm)"/>
    <Exec Command="npm install" Condition="$(Npm)" />
    <Message Text="Npm packages restored." Condition="$(Tsd)"/>
    <Exec Command="node_modules\.bin\tsd reinstall" Condition="$(Tsd)" />
    <Message Text="Tsd packages restored." Condition="'$(Npm)'"/>
    <Exec Command="node_modules\.bin\bower install --config.interactive=false" Condition="$(Bower)" />
    <Message Text="Bower packages restored." Condition="'$(Bower)'"/>
  </Target>

  <Target Name="RunJsBuildTasks" BeforeTargets="AfterBuild">
    <Exec Command="node_modules\.bin\gulp $(Configuration)" Condition="$(Gulp)" />
    <Message Text="Gulp tasks for ($Configuration) ran." Condition="$(Gulp)"/>
    <Exec Command="node_modules\.bin\grunt $(Configuration)" Condition="$(Grunt)"/>
    <Message Text="Grunt tasks for ($Configuration) ran." Condition="$(Grunt)"/>
  </Target>
</Project>
